DROP TABLE IF EXISTS TempData_Delink_CIM_134955
CREATE TABLE TempData_Delink_CIM_134955 (AccountNumber VARCHAR(19), BSAcctID INT, LastStatementDate DATETIME, PlanID INT, DisputesAmtNS MONEY, CurrentBalance MONEY, PaidOutDate DATETIME)
INSERT INTO TempData_Delink_CIM_134955 VALUES ('1100011154853166', 12814854, '2024-08-31 23:59:57.000', 166543140, 0, 0, '2024-08-29 09:12:34.000') -- MergeIssue
INSERT INTO TempData_Delink_CIM_134955 VALUES ('1100011154853166', 12814854, '2024-08-31 23:59:57.000', 166543141, 0, 0, '2024-08-29 09:12:35.000') --MergeIssue
INSERT INTO TempData_Delink_CIM_134955 VALUES ('1100011151708322', 12135156, '2024-08-31 23:59:57.000', 77922796, 0, 0, '2022-03-31 06:36:41.000') -- 0.01 Purchase
INSERT INTO TempData_Delink_CIM_134955 VALUES ('1100011138170489', 4958320, '2024-08-31 23:59:57.000', 10721730, 0, 0, '2020-01-16 15:55:04.000') -- Same TranID for 2 plans
INSERT INTO TempData_Delink_CIM_134955 VALUES ('1100011114535622', 1457169, '2024-08-31 23:59:57.000', 45447540, 0, 0, '2021-04-02 05:41:17.000') -- 0.05 Purchase
INSERT INTO TempData_Delink_CIM_134955 VALUES ('1100011178501106', 17706632, '2024-08-31 23:59:57.000', 54805752, 0, 0, '2021-07-03 14:06:15.000') -- 0.01 Purchase
INSERT INTO TempData_Delink_CIM_134955 VALUES ('1100011149426433', 11518718, '2024-08-31 23:59:57.000', 103774753, 0, 0, '2022-11-29 04:32:02.000') -- Xref not present
INSERT INTO TempData_Delink_CIM_134955 VALUES ('1100011113591527', 1362749, '2024-08-31 23:59:57.000', 98435764, 0, 0, '2023-08-02 13:32:26.000') -- Schedule not present
INSERT INTO TempData_Delink_CIM_134955 VALUES ('1100011113591527', 1362749, '2024-08-31 23:59:57.000', 105887291, 0, 0, '2023-08-02 13:32:26.000') -- Schedule not present


 
DROP TABLE IF EXISTS TempXRef_Delink_CIM_134955
SELECT X.*
INTO TempXRef_Delink_CIM_134955
FROM XRefTable X WITH (NOLOCK)
JOIN TempData_Delink_CIM_134955 T ON (X.ParentATID = 51 AND X.parentAID = T.BSAcctID AND ChildATID = 52 AND X.ChildAID = T.PlanID)


/*


SELECT C.BSAcctID, C.AccountNumber, CP.acctID, CP.SingleSaleTranID, C.RMATranUUID
FROM CPSgmentAccounts CP WITH (NOLOCK)
JOIN CCArd_Primary C WITH (NOLOCK) ON (CP.SingleSaleTranID = C.TranID)
WHERE C.CMTTRanType = '48'
AND C.MergeActivityFlag IS NULL 

*/
