;WITH CTE
AS
(
SELECT T.*, PaymentHistProfile
FROM #TempRecords T
JOIN CBReportingDetail C WITH (NOLOCK) ON (T.acctID = C.acctID AND T.PriorSTmt = C.StatementDate)
WHERE C.ProcessedStatus IN (1, 2)
)
UPDATE T
SET PriorPHP = PaymentHistProfile
FROM #TempRecords T
JOIN CTE C ON (T.acctID = C.acctID)


;WITH CTE
AS
(
SELECT T.*, PaymentHistProfile
FROM #TempRecords T
JOIN CBReportingDetail C WITH (NOLOCK) ON (T.acctID = C.acctID AND T.AfterSTmt = C.StatementDate)
WHERE C.ProcessedStatus IN (1, 2)
)
UPDATE T
SET AfterPHP = PaymentHistProfile
FROM #TempRecords T
JOIN CTE C ON (T.acctID = C.acctID)

SELECT * FROM #TempRecords

SELECT acctID, AccountNumber, UniversalUniqueID, TRY_CAST('2023-01-31 23:59:57' AS DATETIME) PriorStmt, TRY_CAST('2023-02-28 23:59:57' AS DATETIME) AfterStmt
, TRY_CAST(NULL AS VARCHAR(50)) PriorPHP, TRY_CAST(NULL AS VARCHAR(50)) AfterPHP
INTO #TempRecords
FROM BSegment_Primary WITH (NOLOCK)
WHERE acctid IN 
( 194185
, 395123
, 395123
, 395123
, 395123
, 430924
, 433242
, 433242
, 433242
, 989582
, 989582
, 1112487
, 1371402
, 1416782
, 1843140
, 1934035
, 1934035
, 2171515
, 2171515
, 2322795
, 2606897
, 2606897
, 2606897
, 2925807
, 2925807
, 2957084
, 2957084
, 4233332
, 4437630
, 8355370
, 8376882
, 8376882
, 8471294
, 8471294
, 8471294
, 12768397
, 13582050
, 13582050
, 13582050
, 13585835
, 14548620
, 14548620
, 14920730
, 14920730
, 15456360
, 15934880
, 15934880
, 16557183
, 16574769
, 16574769
, 17031515
, 17224664
, 17518961
, 17943778
, 17943778
, 18283260
, 19377270
, 20265420
, 20785235
, 21177475
, 21506352
, 22713261)