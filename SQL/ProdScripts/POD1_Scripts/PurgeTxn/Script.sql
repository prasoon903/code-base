SELECT * FROM #TempPurgeTxn WHERE TranRef = 62312407785

SELECT * FROM CCard_Primary WITH (NOLOCK) WHERE TranRef = 62312407785

DROP TABLE IF EXISTS #TempRecords
;WITH CTE
AS
(
SELECT *, ROW_NUMBER() OVER(PARTITION BY tranref ORDER BY posttime)  [ROW]
FROM #TempPurgeTxn
)
SELECT *
INTO #TempRecords
FROM CTE 
WHERE [ROW] > 1

SELECT * FROM #TempRecords WHERE TranRef = 62312407785

UPDATE TOP(27) LogArTxnAddl SET ExcludeFlag = 1 WHERE TranID IN
(53585774405, 55602622013, 55633369649, 55621645189, 55621645223, 56544423214, 
56540968519, 56999090453, 57288070174, 57288083988, 57288070872, 57683469122, 
57683487507, 57680352296, 57683487508, 58334426855, 58546014935, 60302419590, 
60302696712, 60302419591, 60302684876, 60996222187, 61087522354, 61073976003, 
61316086418, 63544481903, 63312026180)

SELECT ExcludeFlag, *
FROM LogArTxnAddl WITH (NOLOCK)
WHERE TranID IN
(53585774405, 55602622013, 55633369649, 55621645189, 55621645223, 56544423214, 
56540968519, 56999090453, 57288070174, 57288083988, 57288070872, 57683469122, 
57683487507, 57680352296, 57683487508, 58334426855, 58546014935, 60302419590, 
60302696712, 60302419591, 60302684876, 60996222187, 61087522354, 61073976003, 
61316086418, 63544481903, 63312026180)


SELECT ExcludeFlag, * from LogArTxnAddl WITH (NOLOCK) WHERE TranID = 63544481903

SELECT * FROM CCard_Primary WITH (NOLOCK) WHERE TranRef = 62312407785

SELECT *
FROM Trans_in_acct WITH (NOLOCK)
WHERE tran_id_index = 63544481903

DROP TABLE IF EXISTS #TempPurgeTxn
CREATE TABLE #TempPurgeTxn (SN DECIMAL(19, 0) IDENTITY(1, 1), tranref DECIMAL(19, 0),tranid DECIMAL(19, 0),posttime DATETIME,cmttrantype VARCHAR(10),transactionamount MONEY)


--tranref,tranid,posttime,cmttrantype,transactionamount
INSERT INTO #TempPurgeTxn VALUES 
(62312407785, 63544481903, '2022-06-10 09:55:49.000', '88', 1112.49),
(62312407785, 63523941481, '2022-06-10 09:55:02.000', '88', 1112.49),
(63077217903, 63312026180, '2022-06-06 11:18:03.000', '89', 1797.67),
(63077217903, 63312152572, '2022-06-06 11:17:50.000', '89', 1797.67),
(61257720029, 61316086418, '2022-05-12 14:39:20.000', '88', 30.00),
(61257720029, 61261908975, '2022-05-12 14:39:09.000', '88', 30.00),
(61134862975, 61073976003, '2022-05-06 17:33:05.000', '88', 470.45),
(61134862975, 61073976002, '2022-05-06 17:32:34.000', '88', 470.45),
(61086334506, 61087522354, '2022-05-05 14:24:01.000', '88', 300.00),
(61086334506, 60996222187, '2022-05-05 14:24:00.000', '88', 300.00),
(61086334506, 61228158313, '2022-05-05 14:23:59.000', '88', 300.00),
(60084623547, 60302419591, '2022-04-28 02:32:20.000', '88', 400.00),
(60084623547, 60302684876, '2022-04-28 02:32:20.000', '88', 400.00),
(60084622950, 60302696712, '2022-04-28 02:31:04.000', '88', 250.00),
(60084623547, 60302755298, '2022-04-28 02:30:45.000', '88', 400.00),
(60084622950, 60302696711, '2022-04-28 02:28:43.000', '88', 250.00),
(60084622950, 60302419590, '2022-04-28 02:28:43.000', '88', 250.00),
(59016986532, 58546014935, '2022-04-04 05:55:04.000', '89', 1535.25),
(59016986532, 58544911773, '2022-04-04 05:54:43.000', '89', 1535.25),
(57347600010, 58334426855, '2022-03-30 12:35:16.000', '88', 6357.71),
(57347600010, 58334426854, '2022-03-30 12:32:46.000', '88', 6357.71),
(57347595634, 57683487508, '2022-03-16 13:08:47.000', '88', 400.00),
(57347595634, 57680352296, '2022-03-16 13:08:46.000', '88', 400.00),
(57347595634, 57683487507, '2022-03-16 13:08:45.000', '88', 400.00),
(57347595634, 57683631435, '2022-03-16 13:08:09.000', '88', 400.00),
(57347595634, 57683469122, '2022-03-16 13:08:09.000', '88', 400.00),
(57347594584, 57288070872, '2022-03-11 01:10:58.000', '88', 2032.55),
(57347594584, 57288734107, '2022-03-11 01:10:40.000', '88', 2032.55),
(57066499572, 57288083988, '2022-03-08 02:04:08.000', '88', 1000.00),
(57066499572, 57288143870, '2022-03-08 02:03:48.000', '88', 1000.00),
(57066499571, 57288575840, '2022-03-08 02:02:51.000', '88', 1000.00),
(57066499571, 57288070174, '2022-03-08 02:02:51.000', '88', 1000.00),
(57017718408, 56544423214, '2022-03-04 13:33:01.000', '89', 236.92),
(57017718408, 56538509852, '2022-03-04 13:32:42.000', '89', 236.92),
(57019039037, 56540968519, '2022-03-04 12:28:45.000', '89', 958.10),
(57019039037, 56995737858, '2022-03-04 12:28:44.000', '89', 958.10),
(57020877725, 56999090453, '2022-03-04 11:44:26.000', '89', 43.00),
(57020877725, 57018607037, '2022-03-04 11:44:10.000', '89', 43.00),
(56054666108, 55621645223, '2022-02-21 21:24:38.000', '89', 2497.66),
(56054666108, 55622876739, '2022-02-21 21:24:30.000', '89', 2497.66),
(55420330260, 55633369649, '2022-02-21 14:06:00.000', '88', 2000.00),
(55420330260, 56185289854, '2022-02-21 14:01:58.000', '88', 2000.00),
(55420330693, 55621645189, '2022-02-21 10:56:25.000', '88', 52.30),
(55420330693, 56183693267, '2022-02-21 10:50:03.000', '88', 52.30),
(55420327235, 55602622013, '2022-02-09 12:03:52.000', '88', 192.24),
(55420327235, 55616455301, '2022-02-09 12:03:45.000', '88', 192.24),
(53505516098, 53585774405, '2022-01-18 02:28:50.000', '88', 577.99),
(53505516098, 54102957811, '2022-01-18 02:25:57.000', '88', 577.99)